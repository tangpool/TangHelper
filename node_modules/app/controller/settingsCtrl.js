/*jslint latedef:false*/

'use strict';

angular.module('tangHelper.settingsCtrl', [])
    .controller('settingsCtrl', settingsCtrl);

function settingsCtrl($scope, getLocalIP, confManager) {
    /* jshint validthis: true */
    var self = this;

    this.config = {
        type: 'mock',
        pool1URL: 'us1.ghash.io',
        pool1Port: 3333,
        pool2URL: 'us1.ghash.io',
        pool2Port: 3334,
        pool3URL: null,
        pool3Port: null,
        username: 'my',
        prefix: null,
        mask: '255.255.255.0',
        gateway: '192.168.1.1',
        dns1: '192.168.1.1',
        dns2: '8.8.8.8',
        webPort: 80
    };

    getLocalIP().then(function(IPItems) {
        self.ips = IPItems;
    });

    confManager.get().then(function(conf) {
        console.log('conf: ', conf);
        angular.extend(self.config, conf);
    });

    //矿机默认配置 IP 地址，需要带上端口号
    var minerDefaultAddress = {
        mock: 'localhost:9876',
        asic: '192.168.0.254:8000',
        ant: '192.168.0.100:80',
        avalon: '192.168.0.100:80'
    };

    this.selectType = function(type){
        self.config.type = type;
        self.config.minerDefaultAddress = minerDefaultAddress[type];
    };

    if (!this.config.minerDefaultAddress) {
        this.selectType(Object.keys(minerDefaultAddress)[0]);
    }

    //跳转到执行页
    this.goToExecutor = function() {
        confManager.set(self.config).then(function() {
            var url = '/executor.html';
            location.href = url;
        });
    };
}