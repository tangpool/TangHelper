/*jslint latedef:false*/

'use strict';

angular.module('tangHelper.settingsCtrl', [])
    .controller('settingsCtrl', settingsCtrl);

function settingsCtrl($scope, getLocalIP, confManager) {
    /* jshint validthis: true */
    var self = this;

    this.config = {
        type: 'mock',
        pool1URL: 'us1.ghash.io',
        pool1Port: 3333,
        pool2URL: 'us1.ghash.io',
        pool2Port: 3334,
        username: 'my',
        prefix: null,
        mask: '255.255.255.0'
    };

    confManager.get().then(function(conf) {
        angular.extend(self.config, conf);
    });

    getLocalIP().then(function(IPItems) {
        self.ips = IPItems;
    });

    //矿机默认配置 IP 地址，需要带上端口号
    var minerDefaultAddress = {
        mock: 'localhost:9876',
        asic: '192.168.0.254:8000',
        ant: '192.168.0.100:80'
    };
    $scope.$watch(function() {
        return self.config.type;
    }, function(newVal) {
        self.config.minerDefaultAddress = minerDefaultAddress[newVal];
    });

    //跳转到执行页
    this.goToExecutor = function() {
        confManager.set(self.config).then(function() {
            var url = '/executor.html';
            location.href = url;
        });
    };
}