/*jslint latedef:false*/

'use strict';

var app = angular.module('tangHelper.settings', []);

app.controller('settings', settings);

function settings($scope, getLocalIP, confManager) {
    /* jshint validthis: true */
    var self = this;
    this.config = {
        type: 'asic',
        pool1URL: 'us1.ghash.io',
        pool1Port: 3333,
        pool2URL: 'us1.ghash.io',
        pool2Port: 3334,
        username: 'my',
        prefix: null,
        mask: '255.255.255.0'
    };
    getLocalIP().then(function(IPItems) {
        self.ips = IPItems;
    });

    //矿机默认配置 IP 地址
    var minerDefaultIP = {
        asic: '192.168.0.254',
        ant: '192.168.0.100'
    };
    $scope.$watch(function() {
        return self.config.type;
    }, function(newVal) {
        self.config.minerDefaultIP = minerDefaultIP[newVal];
    });

    //跳转到执行页
    this.goToExecutor = function() {
        confManager.set(self.config).then(function() {
            var url = '/executor.html';
            location.href = url;
        });
    };
}